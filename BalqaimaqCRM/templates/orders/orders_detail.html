{% extends 'base.html' %}
{% load static %}
{% load filters %}

{% block title %}
	–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
{% endblock title %}

{% block link %}
	<link rel="stylesheet" href="{% static 'css/products_list.css' %}">
	<link rel="stylesheet" href="{% static 'css/orders_detail.css' %}">
{% endblock link %}

{% block body %}
	<div class="info">
		<div class="heading">
			{% if "create" in request.META.HTTP_REFERER %}
				<button onclick="window.location='{% url 'orders_list' %}'" class="back-without-absolute">ü†ê –ù–∞–∑–∞–¥</button>
			{% else %}
				<button onclick="history.back()">‚Üê</button> 
			{% endif %}

			<h1 style="font-size: 40px;">–ó–∞–∫–∞–∑ #{{order.id}}</h1>

		</div>
		<p>–ö–ª–∏–µ–Ω—Ç: <a href="{% url 'clients_detail' order.phone_number %}"> +{{order.phone_number}} </a></p>
		<p>–ê–¥—Ä–µ—Å: {{order.address}}</p>
		<p>–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞: {{order.created_at|date:"j.m.Y –í—Ä–µ–º—è: H:i" }}</p>
		<p>–¢–∏–ø –æ–ø–ª–∞—Ç—ã: {{order.get_type_of_payment_display}}</p>
		<p>–¢–∏–ø –∑–∞–∫–∞–∑–∞: {{order.get_type_of_order_display}}</p>
		<p>–≠—Ç–∞–ø –∑–∞–∫–∞–∑–∞: {{order.get_stage_display}}</p>

		<div style="margin-top: 20px;" class="heading">
			<button class="update" onclick="window.location='{% url 'orders_update' order.id %}'">–ò–∑–º–µ–Ω–∏—Ç—å</button>
			<button class="delete" onclick="window.location='{% url 'orders_delete' order.id %}'">–£–¥–∞–ª–∏—Ç—å</button>
		</div>

		<h2>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</h2>
		{% if error %}
			<div class="error">
				–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç –≤ –∑–∞–∫–∞–∑, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–∞ —Å–∫–ª–∞–¥–µ –Ω–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞
			</div>
		{% endif %}
		<form method="post">
			{% csrf_token %}
			{{ order_item_add_form.as_p }}
			<button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
		</form>
		<h2>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–±–æ</h2>
		<form method="post">
			{% csrf_token %}
			{{ order_combo_add_form.as_p }}
			<button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
		</form>
	</div>

	<div class="items">
		<table>
			<tr>
				<th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
				<th>–ò–º—è</th>
				<th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
				<th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
				<th>–°—É–º–º–∞</th>
				<th>–£–¥–∞–ª–∏—Ç—å?</th>
			</tr>
			{% for product in order_items %}
				{% if forloop.counter0|divisibleby:2 %}
					<tr onclick="window.location='{% url 'products_detail' product.id %}'" class="white">
						<td><img src="{{ product.product.image.url }}" alt=""></td>
						<td>{{product.product.name}}</td>
						<td>{{product.amount}} –∫–≥</td>
						<td>{{product.product.sell_price|floatformat:0}}‚Ç∏</td>
						<td>{{product.get_cost}}‚Ç∏</td>
						<td><a class="" href="{% url 'orders_item_delete' product.id %}">—Ö</a></td>
					</tr>
				{% else %}
					<tr onclick="window.location='{% url 'products_detail' product.id %}'" class="gray">
						<td><img src="{{ product.product.image.url }}" alt=""></td>
						<td>{{product.product.name}}</td>
						<td>{{product.amount}} –∫–≥</td>
						<td>{{product.product.sell_price|floatformat:0}}‚Ç∏</td>
						<td>{{product.get_cost}}‚Ç∏</td>
						<td><a class="" href="{% url 'orders_item_delete' product.id %}">—Ö</a></td>
					</tr>
				{% endif %}
			{% endfor %}

			{% if order_combos.count > 0 %}
				<tr>
					<th></th>
					<th></th>
					<th></th>
					<th></th>
					<th></th>
					<th></th>
				</tr>
			{% endif %}

			{% for combo in order_combos %}
				{% if forloop.counter0|divisibleby:2 %}
				<tr class="white">
					<td>
						<img src="{{combo.combo.image.url}}" alt=""> <br>
					</td>
					<td>
						<b>{{combo.combo.name}}</b> <br>
						{% if combo.combo.name != "–°–∞–º—Å–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ 1 –∫–≥" and combo.combo.name != "–°–∞–º—Å–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ 0.5 –∫–≥" %}
							{% for product in combo.combo.products.all %}
								{{product.name}} <br>
							{% endfor %}
						{% endif %}
					</td>
					<td>
						{% if combo.combo.name != "–°–∞–º—Å–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ 1 –∫–≥" and combo.combo.name != "–°–∞–º—Å–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ 0.5 –∫–≥" %}
						<br>
						{% endif %}
						{% for product in products_in_combo|get_value_from_dict:combo.combo.name %}
							{% if forloop.counter0 == 2 %}
								<p>{{products_in_combo|get_value_from_dict:combo.combo.name|get_value_from_dict:product}} –∫–≥ x{{combo.amount|floatformat:"0"}}</p>
							{% else %}
								<p>{{products_in_combo|get_value_from_dict:combo.combo.name|get_value_from_dict:product}} –∫–≥</p>
							{% endif %}
						{% endfor %}
					</td>
					<td>{{combo.combo.price}} ‚Ç∏</td>
					<td><p>{{ combo.combo.price|multiply:combo.amount|floatformat:"2" }} ‚Ç∏</p></td>
					<td><a class="" href="{% url 'orders_combo_delete' combo.combo.id order.id %}">—Ö</a></td>
				</tr>
				{% else %}
				<tr class="gray">
					<td>
						<img src="{{combo.combo.image.url}}" alt=""> <br>
					</td>
					<td>
						<b>{{combo.combo.name}}</b> <br>
						{% if combo.combo.name != "–°–∞–º—Å–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ 1 –∫–≥" and combo.combo.name != "–°–∞–º—Å–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ 0.5 –∫–≥" %}
							{% for product in combo.combo.products.all %}
								{{product.name}} <br>
							{% endfor %}
						{% endif %}
					</td>
					<td>
						{% if combo.combo.name != "–°–∞–º—Å–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ 1 –∫–≥" and combo.combo.name != "–°–∞–º—Å–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ 0.5 –∫–≥" %}
						<br>
						{% endif %}
						{% for product in products_in_combo|get_value_from_dict:combo.combo.name %}
							{% if forloop.counter0 == 2 %}
								<p>{{products_in_combo|get_value_from_dict:combo.combo.name|get_value_from_dict:product}} –∫–≥ x{{combo.amount|floatformat:"0"}}</p>
							{% else %}
								<p>{{products_in_combo|get_value_from_dict:combo.combo.name|get_value_from_dict:product}} –∫–≥</p>
							{% endif %}
						{% endfor %}
					</td>
					<td>{{combo.combo.price}} ‚Ç∏</td>
					<td><p>{{ combo.combo.price|multiply:combo.amount|floatformat:"2" }} ‚Ç∏</p></td>
					<td><a class="" href="{% url 'orders_combo_delete' combo.combo.id order.id %}">—Ö</a></td>
				</tr>
				{% endif %}
			{% endfor %}

			<tr>
				<th></th>
				<th></th>
				<th></th>
				<th>–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞:</th>
				<th>{{order.get_total_cost}} ‚Ç∏</th>
				<th></th>
			</tr>
		</table>
		
	</div>
{% endblock body %}